# == 基本描画 / パフォーマンス
gpu-api=d3d11 # または vulkan（環境により選択）
load-scripts=yes

# == 再生・シークの応答性を優先したキャッシュ設定
cache=yes
demuxer-readahead-secs=120 # デマルチプレクサの先読み（秒）拡張
demuxer-max-bytes=4096MiB # 前方4GBキャッシュ
demuxer-max-back-bytes=4096MiB # 後方4GBキャッシュ（1コマ戻し高速化）
demuxer-donate-buffer=yes # 逆方向スクラブの柔軟性を高めるため明示的に設定
demuxer-cache-wait=yes # ファイルデータを先行キャッシュ（即時スクラブ用）
cache-on-disk=no # RAM上のキャッシュを優先、ディスクキャッシュは不使用
framedrop=no # 通常再生時のフレームドロップを完全に禁止

# == シーク設定（フレーム単位移動の正確性）
hr-seek=yes # フレーム単位の正確な移動
hr-seek-framedrop=no # シーク時のフレームドロップ無効
seekbarkeyframes=no # シークバーでキーフレーム無視
force-seekable=yes # 常にシークを有効化する

# デコーダスレッド数の最適化
vd-lavc-threads=0 # デコーダのスレッド使用を最小限に抑えると低遅延化が可能、スレッド数による差を要検証

# === 軽量化・性能優先
profile=fast # 性能優先モード
priority=high # プロセス優先度を高に設定
interpolation=no # フレーム補間無効（明示的に無効化）
video-latency-hacks=no
# dither=no                        # ディザリング無効（軽量化）

# == 出力品質は最低限で良い（画質フィルタは切る）
linear-downscaling=no # 線形ダウンスケーリング無効

# 高品質なスケーラは不要
scale=bilinear
dscale=bilinear

# ビデオフィルタチェーンの初期化（不要なフィルタをすべて排除）
vf= # ビデオフィルタなし

# === 逆再生関連オプション
video-reversal-buffer=2048MiB # 逆再生用のバッファサイズを多めに設定
demuxer-backward-playback-step=60 # 逆再生時にdemuxerが後方シークする秒数

# === オーディオ設定
aid=auto # 音声は重要ですが、タイミング合わせのため自動選択で十分です。
audio-pitch-correction=yes # 再生速度変更時も音程を維持
volume=100 # 初期音量
volume-max=150 # 最大音量

# == OSD / 表示
# osd-status-msg OSDステータスメッセージのフォーマット。フレーム数を優先表示するために使用します。
osd-status-msg=Frame: ${estimated-frame-number} / ${estimated-frame-count} (FPS: ${container-fps})

osd-level=3 # OSD表示レベル（0-3 1=シーク時のみ、今はテスト段階なので3）
osd-duration=2000 # OSD表示時間（ミリ秒）
osd-font-size=32 # OSDフォントサイズ
osd-on-seek=msg-bar           # シーク時はメッセージバーに表示
osd-msg1="${time-pos} / ${duration}"  # 表示フォーマット

# === 複数ウィンドウ起動
process-instance=multi # 常に新規ウィンドウで起動
ontop=no # 常に最前面表示はしない
geometry=50%:50%+0+0 # 左上 # 左上（または +960+0 で右上）

# == 再生動作
loop-file=inf # GUI側でループを管理することを推奨
keep-open=yes # 再生終了でアプリが閉じるのを抑止（mpvのみでの挙動）

# ===== GIF専用プロファイル

hdr-compute-peak=no
allow-delayed-peak-detect=no
libplacebo-opts=preset=fast,upscaler=none,downscaler=none,frame_mixer=none

[extension.gif]
demuxer-max-bytes=4096MiB
demuxer-max-back-bytes=4096MiB
loop-file=inf

# ウィンドウドラッグを無効化（mpv.net対応）
# mpv.netではこのオプションの動作が異なる場合があるので注意
# window-dragging=no  # コメントアウト: 代わりにLuaスクリプトで制御

# マウスカーソル表示設定
cursor-autohide=1000           # 1秒後にカーソル非表示
cursor-autohide-fs-only=no     # ウィンドウモードでも適用

# 注意: これらはmpv.netでは効果なし
# no-window-dragging
# window-dragging=no

# OSC設定（スクラブと競合しないように）
# osc=yes は維持するが、スクラブエリアと競合しない高さに調整
osc=yes
# osc.confで調整済み

# mpv.netでのマウスイベント処理を最適化
input-builtin-bindings=yes     # 組み込みバインディング有効
input-default-bindings=yes     # デフォルトバインディング有効

# msg-level=all=v # 詳細ログを有効化